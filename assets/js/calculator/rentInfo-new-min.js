/*======================================================================*\
|| #################################################################### ||
|| # ---------------------------------------------------------------- # ||
|| # Copyright 2016 Home Net Property Services Ltd. Hong Kong         # ||
|| # All Rights Reserved.                                             # ||
|| # This file may not be redistributed in whole or significant part. # ||
|| # http://www.homenet.com.hk                                        # ||
|| # ---------------------------------------------------------------- # ||
|| #################################################################### ||
\*======================================================================*/
!function(t){t.fn.rentInfo=function(e){var a,s,d,n,l,r,c,h,o,i,y,p,m,u,g,f,v,D,b,M=0,x=0,F={header:"Rental Summary",month:"Month",monthStart:"Month Start",monthEnd:"Month End",dayMonth:"Days in Month",rentFree:"Rent Free Days",dayPayable:"Days Payable",payableMonth:"Payable Months",Copr:"194 169 032 050 048 049 054 032 072 111 109 101 032 078 101 116 032 080 114 111 112 101 114 116 121 032 083 101 114 118 105 099 101 115 032 076 116 100 046 032 104 116 116 112 058 047 047 119 119 119 046 104 111 109 101 110 101 116 046 099 111 109 046 104 107 047",rentPerMonth:"Rent Payable Per Month"},w={averageRent:"Average Annual Rent",stampDuty:"Stamp Duty Total",extraFee:"(extra fee for a copy)",payable:"Payable per party"},N=e.printing;function S(){(function(){M=Number(l.val().replace(/[^0-9\.]+/g,"")),""==r.val()?a=new Date:((b=r.val().split("/"))[1]=Number(b[1].replace(/[^0-9\.]+/g,"")),b[1]=isNaN(b[1])?0:b[1],b[1]=b[1]-1,a=new Date(b[2],b[1],b[0]));o=a,n=parseInt(c.val()),o.getTime()<a.getTime()&&(o=a);if(d=Number(i.val().replace(/[^0-9\.]+/g,"")),d=isNaN(d)?0:d,0==M)return!1;if(isNaN(a.getTime()))return!1;if(isNaN(d))return!1;if(isNaN(n))return!1;return!0})()&&((s=new Date(new Date(a).setMonth(a.getMonth()+n))).setDate(s.getDate()-1),h=(s.getTime()-a.getTime())/864e5+1,t(e.toDate).html(T(s)),t(e.totalDays).html(h),v.empty(),v.append(function(){var e,s,l,c,h,o,i,y=0,p=0,m=d,u=0,g=m,f=0,v=0,D=t("<table></table>");x=0,D.append('<tr class="header"><th class="m"><div class="head">'+F.header+'</div></th><th class="dt"></th><th class="dt end"></th><th class="dy days"></th><th class="dy free"></th><th class="dy"></th><th class="dy"></th><th class="tt"></th></tr><tr class="headerrow"><th class="m">'+F.month+'</th><th class="dt">'+F.monthStart+'</th><th class="dt end">'+F.monthEnd+'</th><th class="dy days">'+F.dayMonth+'</th><th class="dy free">'+F.rentFree+'</th><th class="dy">'+F.dayPayable+'</th><th class="dy">'+F.payableMonth+'</th><th class="tt">'+F.rentPerMonth+"</th></tr>");for(var b=0;b<n;b++){y=b+1,e=b>0?new Date(new Date(s).setDate(s.getDate()+1)):new Date(new Date(a).setMonth(a.getMonth()+b)),(s=new Date(new Date(e).setMonth(e.getMonth()+1))).setDate(s.getDate()-1),p=(s.getTime()-e.getTime())/864e5+1,u+=p,h=(l=(l=p-m)>p?p:l<0?0:l)<0?0:l>p?p:l,f+=l,payableMonth=l/p,i=payableMonth<0?0:payableMonth,v+=payableMonth,c=payableMonth*M,o=m>p?p:m;var w=(c=c<0?0:c).toFixed(2).replace(/./g,function(t,e,a){return!e||"."===t||(a.length-e)%3?t:","+t});""==r.val()?D.append('<tr class="contentrow"><td class="m">'+y+'</td><td class="dt"></td><td class="dt end"></td><td class="dy days"></td><td class="dy free"></td><td class="dy"></td><td class="dy">'+i.toFixed(2)+'</td><td class="tt">$'+w+"</td></tr>"):D.append('<tr class="contentrow"><td class="m">'+y+'</td><td class="dt">'+T(e)+'</td><td class="dt end">'+T(s)+'</td><td class="dy days">'+p+'</td><td class="dy free">'+o+'</td><td class="dy">'+h+'</td><td class="dy">'+i.toFixed(2)+'</td><td class="tt">$'+w+"</td></tr>"),l>0?m=0:(m-=p,l=0),x+=c}var N="$"+x.toFixed(2).replace(/./g,function(t,e,a){return!e||"."===t||(a.length-e)%3?t:","+t});""==r.val()?D.append('<tr class="totals"><td class="m"></td><td class="dt"></td><td class="dt end"></td><td class="dy days"></td><td class="dy free"></td><td class="dy"></td><td class="dy">'+v.toFixed(2)+'</td><td class="tt">'+N+"</td></tr>"):D.append('<tr class="totals"><td class="m"></td><td class="dt"></td><td class="dt end"></td><td class="dy days">'+u+'</td><td class="dy free">'+g+'</td><td class="dy">'+f+'</td><td class="dy">'+v.toFixed(2)+'</td><td class="tt">'+N+"</td></tr>");return D}()),function(){var t=n<12?x:x/n*12,e="$"+(t=(100*Math.ceil(t/100)).toFixed(0)).toString().replace(/./g,function(t,e,a){return!e||"."===t||(a.length-e)%3?t:","+t});u.html(e+"<br /><span>"+w.averageRent+"<span/>");var a=n<=12?.0025:n>36?.01:.005;m.children().removeClass("selected"),.0025==a&&n<=12?m.children().eq(1).addClass("selected"):.005==a?m.children().eq(2).addClass("selected"):m.children().eq(3).addClass("selected");var s=100*a,d=t*a,l="$"+d.toFixed(2).replace(/./g,function(t,e,a){return!e||"."===t||(a.length-e)%3?t:","+t});f.html(l+"<br /><span>"+w.stampDuty+"<span/>");var r="%"+s.toFixed(2).replace(/./g,function(t,e,a){return!e||"."===t||(a.length-e)%3?t:","+t});g.html(r+"<br /><span>"+w.atRate+"<span/>");var c="$"+((d+N)/2).toFixed(2).replace(/./g,function(t,e,a){return!e||"."===t||(a.length-e)%3?t:","+t});p.html(c+" "+w.payable)}(),D.fadeIn())}return void 0!==e.copyCost&&(N=e.copyCost),t.extend(F,e.tableText),t.extend(w,e.dutyText),l=t(e.rent),r=t(e.startDate),t(e.rentFreeStart),t(e.rentFreeEnd),i=t(e.totalRentFree),c=t(e.terms),p=t(e.dutyBox),m=t(e.dutyDetails),v=t(e.tableBox),y=t(e.reset),u=t(e.averageAnnual),g=t(e.atRate),f=t(e.totalStampDuty),D=t(e.fadeBox),this.click(function(){S()}),y.click(function(){u.html('<span class="empty min">Fill in the details below to start calculating</span>'),f.html(""),p.html('<div class="empty-total"></div>'),g.html(""),m.children().removeClass("selected"),v.html(""),r.val(""),i.val(""),c.val("24"),l.val(",000"),D.fadeIn()}),S(),this;function T(t){var e=t.getFullYear().toString(),a=(t.getMonth()+1).toString(),s=t.getDate().toString();return(s[1]?s:"0"+s[0])+"/"+(a[1]?a:"0"+a[0])+"/"+e}}}(jQuery);